README for OSCAR 4.0 with Red Hat Enterprise Linux 3 AS

Date: 2004/12/13

Author: David Lombard
	Yves Trudeau <yves.trudeau@revolutionlinux.com>
        Fernando Camargos <fernando@revolutionlinux.com>

Note: These instructions are for Red Hat Enterprise Linux 3 (U3); see
Step 2 if you are using the Gold or U2 versions.


1) mysql-server
   ------------

You will need to obtain a mysql-server rpm and put it into
/tftpboot/rpm before starting the OSCAR Wizard.  The easiest way is to
get the SRPM and rebuild it,

    rpmbuild --rebuild mysql-3.23.58-1.src.rpm
    cp /usr/src/redhat/RPMS/ia64/mysql-server-3.23.58-1.ia64.rpm \
        /tftpboot/rpm

MySQL v3.23.58-1 is the version that came with RHAS3U3, if you cannot
find that particular version, please make sure that you copy all the
rebuilt MySQL RPMs (including the server RPM).  For example if the
version you could find is v3.23.58-2.3:

    rpmbuild --rebuild mysql-3.23.58-2.3.src.rpm
    cp /usr/src/redhat/RPMS/ia64/mysql*-3.23.58-2.3.ia64.rpm \
        /tftpboot/rpm 

The key here is to keep the MySQL versions consistent.


2) Red Hat Enterprise Linux 3 (Gold or U2) rpmlist
   -----------------------------------------------
 
If you're running an earlier version than U3, you will need to
manually select the correct rpmlist before generating the client image
in Step 4.  You need to select the appropriate file for your
architecture

    /opt/oscar/oscarsample/redhat-3asU2-i386.rpmlist
or
    /opt/oscar/oscarsample/redhat-3asU2-ia64.rpmlist


3) Initrd and elilo.conf
   ---------------------

There is a problem generating a valid initrd on the nodes, so we must
provide one in the image.  After the client image is generated by the
OSCAR Wizard (step 4), copy a valid initrd to /boot/efi/EFI/redhat on
the image:

    cp /boot/efi/efi/redhat/initrd-*.img \
        /var/lib/systemimager/images/oscarimage/boot/efi/EFI/redhat/
    
    cp /boot/efi/efi/redhat/elilo.conf \
        /var/lib/systemimager/images/oscarimage/boot/efi/EFI/redha/


4) systemconfig.conf
   ----------------- 
 
You will also need to add an INITRD entry to the image
/etc/systemconfig/systemconfig.conf file.  After the modification, the
kernel section should look like this:

     [KERNEL0]
        PATH = /boot/efi/EFI/redhat/vmlinuz-2.4.21-20.EL
        INITRD = /boot/efi/EFI/redhat/initrd-2.4.21-20.EL.img
        LABEL = 2.4.21-20.EL
where
      2.4.21-20.EL is the kernel for Red Hat Enterprise Linux 3 (U3)
      You should substitute your kernel version if you're not running
      U3.


5) SCSI and network
   ----------------

Edit the file
/var/lib/systemimager/images/oscarimage/etc/systemconfig/systemconfig.conf
and add an Hardware section with SCSI and network drivers.  For the
SR870BH2, the hardware section of this file will look like this:

    [HARDWARE]
        ORDER = e1000 e1000 mptscsih mptbase scsi_mod


6) USB
   ---

If you need to use the keyboard on a USB-only system like the Intel
SR870BH2, you need to add the USB controller to /etc/modules.conf of
the OSCAR image.  For example,

  echo alias usb-controller usb-uhci >> \
     /var/lib/systemimager/images/oscarimage/etc/modules.conf


7) tftp-server
   -----------

BEFORE you boot the client nodes, you will need to replace the TFTP
server.  If your distrubition doesn't come with a tftp-server package
you should download and install the appropriate file from a
repository.  Once you have downloaded and copied it to a known
directory you must install the package and turn it on:

	rpm -i tftp-server-0.32-4.ia64.rpm  

(it could be "ia64" or "i386", depending of your machine's
architecture).

	/sbin/chkconfig --level 345 tftp on 


8) DISKORDER
   ---------

In some systems using CD-ROM and SCSI disks, you may have to modify
the diskorder sequence in the oscarimage.master script
(/var/lib/systemimager/scripts) to prevent the system to recognize
your CD-ROM as the main disk, resulting in a "Kernel panic" during the
client's installation phase:

       from:  echo DISKORDER=${DISKORDER=hd,sd,cciss,ida,rd}
         to:  echo DISKORDER=${DISKORDER=sd,hd,cciss,ida,rd}


9) elilo
   -----

If Linux doesn't properly boot after the installation of the image,
you may have to manually boot it from the correct path.  Chose the
"EFI Shell" boot option (SR870BH2), then access the correct device (in
our case fs0), copy elilo.efi and elilo.conf to the root ("cp
\EFI\redhat\elilo.efi \", "cp \EFI\redhat\elilo.conf \") and boot from
there ("elilo.efi 2.4.21-15.EL").
